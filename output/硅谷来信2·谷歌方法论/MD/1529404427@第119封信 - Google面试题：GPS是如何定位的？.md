# 第119封信 | Google面试题：GPS是如何定位的？

今天讲一个突破我们认知的事情。我还是先从一道Google面试题讲起，这道题很容易理解，是这样出的：

 **GPS定位是怎样实现的？无人驾驶汽车需要非常准确的GPS定位，在为它设计GPS系统时，我们要考虑什么，在寻找行驶路线时，又要注意什么呢？**

很多时候，越是能用几句话简单地描述清楚的题目，解答起来越是复杂，因为里面很多信息都不明确，需要特别说明清楚后，才好解答。另外，看似简单的题目里面可能会有陷阱，这道面试题也是如此。

由于这道题目比较专业，我就不分析那些错误的回答了，这次我们直奔主题。我们先来说说定位的原理。

如果你还记得高中所学的立体几何和解析几何学知识，就明白， **空间中的任何一点，都可以用（X，Y，Z）这三个坐标值唯一地确定。** 要找到这三个未知数的值，就需要有三个方程。地球的球面是一个二次曲线，这是第一个方程，和某个卫星等距离的所有点，也构成一个二次曲面，这是第二个方程。至于第三个方程，你再找一颗卫星就可以了。

因此 **GPS定位的原理其实特别简单，就是用两个卫星，加上地球，用三个二次曲面的方程，解出X，Y，Z的值。** 不过，这样得到的解可能不止一个，而是两个，因此需要加入第三颗卫星确定唯一的位置。当然，为了更精确地定位，通常采用四颗卫星。

上面这种坐标被称为直角坐标，因为X，Y和Z这三根轴都是垂直的，不过英语里它一般被称为笛卡尔坐标，因为是由笛卡尔提出来的。采用直角坐标的好处是，地球上的点，和卫星的位置，都可以放到同一个坐标系下。

当然，给你X，Y，Z，你想象不出具体的位置，而我们在地球上通常用经纬度坐标，经纬度虽然也是人为设定的，但是人类用了几千年，这种特殊的坐标已经成为今天人类最直观、最容易理解的位置度量了。因此，GPS的工作实际上是要做一个坐标的转换。

对于卫星，其实还有一个不同的坐标系，它也有三个变量，卫星到地心的距离，卫星的两个夹角（你可以理解为卫星的经纬度）。这样的坐标便于卫星监测，但是要计算距离，也要转化成直角坐标。

现在坐标系确定了，位置的计算方法有了，照说就能用GPS定位了。但是，如果就这样来计算位置的话，那误差就大得不得了了。因此，GPS的精度其实就取决于如何消除误差。讲起来，引起GPS误差的因素特别特别多，我把这些误差根据它们的来源，分成这样两类：

第一类是卫星和接收装置本身引起的误差，我举这样两种：

 **1. 星历和时钟的误差。**

计算卫星和地面距离，其实是根据电磁波传播速度和传播时间推导出来的，并不是用尺子直接量的。电磁波的速度就是光速，这个相对好确定。但是时间的度量却不容易，要知道卫星上的时钟和地面上时钟之间是有误差的。如果误差了0.1毫秒，也就是一秒钟的万分之一，定位就会差出30公里。怎么校正这个误差不是我们今天内容的重点，我们就跳过去了。

顺便提一句，罗老师曾经讲过一期关于航海钟的罗辑思维节目，里面讲到了一些类似的原理。你如果有兴趣可以去听听。

 **2. 相对论的误差。**

这种说法并不是说爱因斯坦的相对论不对，有误差，而是说狭义相对论指出了卫星上高速运动的时钟会比地球上的钟走得慢，而广义相对论指出重力场的作用也会导致时间测量的误差。校正这两点误差我们要感谢爱因斯坦，没有它的相对论，我们就没有准确的GPS定位。

今天你依然能在媒体上时不时地看到这类的报道，某某民间科学家推翻了爱因斯坦相对论。事实上相对论不仅越来越多地被验证，而且已经应用到了我们的生活中。在一次采访中，一位记者问我 **理论研究和应用技术研究哪个更重要。我和他讲，从长远来看，所有的科学研究都是应用研究，相对论的作用便证实了这一点。**

 **第二类的误差来自于信号传输速度的不稳定。** 从卫星到地球表面不是真空，因此光速并不恒定。我们知道地球的大气层密度不同，电磁波信号传播的速度其实和真空光速是有误差的，而且地球上还有电离层，它会造成信号传输的延时。

当然，地球的自转其实速度也不匀，这个误差也要消除。

如果要把构成GPS误差的因素总结一下，可以满满地写两页纸，因此这里我们就不详细论述了。总之，任何一个误差，如果不进行校正，会使得导航的偏差小则几百米，多则几十公里。

一个没有GPS定位工作经验的候选人，如果数学功底比较深，面对这道面试题，能说出GPS的基本定位。但是，他并不清楚要想让GPS工作，必须校正哪些误差，如何校正。在Google这样的公司，通常不会对候选人有这么苛刻的要求，因为他们到了公司里还可以继续学习，但是，如果候选人没有误差的概念，做自动驾驶这种工作就不合适。

至此，我要总结一下Google这方面面试的第一个原则，就是 *遇到问题不可怕，只要不是致命的，知道了问题就能找到解决方法。* 对候选人来说，Google要求他们对基本概念和方法非常了解，但是具体的技术可以学习。前者不了解，问题是致命的，后者不了解，可以学习。

对于GPS这项技术，只要知道了误差来自于何方，就能想办法解决，比如通过对上面我提到的误差的校正，可以把误差降低五个数量级，也就是精度从上百公里做到一米左右。这里面精度提高幅度之大，恐怕已经超出普通人的认知了。

另外说一句，为什么科技发展到今天，业余的人机会很少呢？以GPS为例，业余爱好者能把各种误差降低两、三个数量级就很不错了，那么精度只有几公里到几百米，根本不实用，是不可能开发无人驾驶汽车的。

 *既然解决问题的关键是知道问题所在，那么发现问题就比解决问题显得更重要，* 这也是我经常讲的一个观点，最好的教授要能发现问题，二流的教授可以解决问题。在GPS定位中，星历的误差，信号传输虽然影响大，但是稍微有点物理常识的人都能意识到。但是相对论的误差，如果没有爱因斯坦的相对论，你就对此毫无办法，错都不知道错在了哪里。

爱因斯坦的广义相对论，其实是超出了我们生活的直觉的，因为他所考虑的世界和我们日常生活的世界有很大的差异，我们人的感官是感觉不到广义相对论所描述的那些变化的。这就是我今天要讲的第二个要点，即 *我们在做很多事情时必须突破日常的认知。* 广义相对论有一个数学基础，就是黎曼几何，而这个数学工具本身用我们日常的认知，就是难以理解的。

讲到几何学，我们都知道当年欧几里得用五个概念和五条公理搭建了整个几何学的大厦。那些公理则是不证自明的，比如"从一点向另一点可以引一条直线"，就是一条公理。对于前四条公理，大家都没有疑问，但是，对于第五条，也就是平行公理，"通过一个不在直线上的点，有且仅有一条不与该直线相交的直线"，就有人跳出来反对了。

一个人叫做罗巴切夫斯基，他说过"一个点能做多条平行线"，另一个叫做黎曼，他说过"一个点一条平行线也做不出来"。修改掉这一条公理，整个几何学都要修改了。

根据我们的生活经验，罗巴切夫斯基和黎曼都是错的，欧几里得是对的。但是，如果我们突破有限的空间，我们会发现由于引力场的存在，我们的宇宙是黎曼所描述的那种样子，而不是欧几里得所说的。爱因斯坦推导广义相对论，就用了黎曼几何这个工具。

类似地，在地球上，你要准确计算两个给定经纬度坐标的位置之间的距离，也需要用黎曼几何，这就是对Google那道面试题第三个小问题的答案，无人车准确行驶的条件是知道地球是圆的，而不是平的，因此要对路线不断校正。

我们平时只是因为活动的范围不够大，以至于采用欧几里得几何和黎曼几何没有差别。同时我们人不自觉地会按照周围的景物，校正我们的方位。正因为像相对论和黎曼几何，很难根据我们的生活经验理解它们，因此系统学习就变得特别重要。

最后总结一下今天的内容：

 *1. 很多时候误差比我们想象的大得多，* 这也是为什么直接应用很多原理不管用的原因。

 *2. 找到了问题的结症比解决问题有时更重要。*

3. 我们的生活经历会妨碍我们的想象力和认知， *只有学习才能突破自身的局限。*

4. 当然，我们再一次复习了等价性的原理，即地球坐标和直角坐标是等价的。而 *对于同一个问题，在不同坐标系中的难度是不同的，因此找到合适的工具很重要。*

 **思考题：** 通常人们想不到GPS做不好误差会那么大，真可谓是差之毫厘，谬之千里。能否就此发表你的看法？

![https://piccdn3.umiwi.com/img/201806/19/201806191834308251604069.png](https://piccdn3.umiwi.com/img/201806/19/201806191834308251604069.png)

## 划重点

1. 很多时候误差比我们想象的大得多。

2. 找到了问题的结症比解决问题有时更重要。

3. 我们的生活经历会妨碍我们的想象力和认知，只有学习才能突破自身的局限。

4. 对于同一个问题，在不同坐标系中的难度是不同的，因此找到合适的工具很重要。

## 寻找知识伙伴

你可以寻找你的一位知识伙伴，一同探讨留给你的思考题。互相讨论、你来我往，可以让你们一同进步。

为了鼓励你表达，以及可以发起有碰撞的讨论，我们会在 *6月16日—6月22日（7日内）找到分享来信最多次的一位读者，送出一份《吴军的谷歌方法论》的兑换码* ，让你的知识伙伴，可以和你一起读一整年的来信。

你可以点击每篇内容右下角的 **“请朋友读”** 分享，现在就开始寻找一位你的知识伙伴吧！

![https://piccdn3.umiwi.com/img/201806/19/201806191834571882329498.jpg](https://piccdn3.umiwi.com/img/201806/19/201806191834571882329498.jpg)

---
